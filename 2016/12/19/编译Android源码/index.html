<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="##编译版本要求

##基本安装环境
###ubuntu 14.04 64
sudo apt-get install git-core gnupg flex bison gperf build-essential \
  zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 \
  lib32ncurses5-dev x11pro">
<meta property="og:type" content="article">
<meta property="og:title" content="编译Android源码">
<meta property="og:url" content="qusir.github.io/2016/12/19/编译Android源码/index.html">
<meta property="og:site_name" content="QUSIR">
<meta property="og:description" content="##编译版本要求

##基本安装环境
###ubuntu 14.04 64
sudo apt-get install git-core gnupg flex bison gperf build-essential \
  zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 \
  lib32ncurses5-dev x11pro">
<meta property="og:image" content="https://lianghuanhan.club/images/%E7%BC%96%E8%AF%91%E7%89%88%E6%9C%AC%E8%A6%81%E6%B1%82.png">
<meta property="og:updated_time" content="2018-05-31T10:47:26.539Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="编译Android源码">
<meta name="twitter:description" content="##编译版本要求

##基本安装环境
###ubuntu 14.04 64
sudo apt-get install git-core gnupg flex bison gperf build-essential \
  zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 \
  lib32ncurses5-dev x11pro">
<meta name="twitter:image" content="https://lianghuanhan.club/images/%E7%BC%96%E8%AF%91%E7%89%88%E6%9C%AC%E8%A6%81%E6%B1%82.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="qusir.github.io/2016/12/19/编译Android源码/"/>





  <title>编译Android源码 | QUSIR</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">QUSIR</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="qusir.github.io/2016/12/19/编译Android源码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="我思，故我在！">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QUSIR">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">编译Android源码</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-19T21:29:48+08:00">
                2016-12-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>##编译版本要求</p>
<p><img src="https://lianghuanhan.club/images/%E7%BC%96%E8%AF%91%E7%89%88%E6%9C%AC%E8%A6%81%E6%B1%82.png" alt=""></p>
<p>##基本安装环境</p>
<p>###ubuntu 14.04 64</p>
<pre><code>sudo apt-get install git-core gnupg flex bison gperf build-essential \
  zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 \
  lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z-dev ccache \
  libgl1-mesa-dev libxml2-utils xsltproc unzip
</code></pre><p>###ubuntu 16.04 64</p>
<pre><code>sudo apt-get install libx11-dev:i386 libreadline6-dev:i386 libgl1-mesa-dev g++-multilib 
sudo apt-get install -y git flex bison gperf build-essential libncurses5-dev:i386 
sudo apt-get install tofrodos python-markdown libxml2-utils xsltproc zlib1g-dev:i386 
sudo apt-get install dpkg-dev libsdl1.2-dev libesd0-dev
sudo apt-get install git-core gnupg flex bison gperf build-essential  
sudo apt-get install zip curl zlib1g-dev gcc-multilib g++-multilib 
sudo apt-get install libc6-dev-i386 
sudo apt-get install lib32ncurses5-dev x11proto-core-dev libx11-dev 
sudo apt-get install libgl1-mesa-dev libxml2-utils xsltproc unzip m4
sudo apt-get install lib32z-dev ccache
</code></pre><p>##配置环境变量<br>    source build/envsetup.sh</p>
<p>##设置编译选项<br>    lunch aosp_hammerhead-userdebug</p>
<p>##编译<br>    make -j4<br>make失败或停止后，可以使用make -k 继续编译</p>
<p>##运行模拟器<br>在编译完成之后,就可以通过以下命令运行Android虚拟机了,<br>命令如下:</p>
<pre><code>source build/envsetup.sh

lunch(选择刚才你设置的目标版本,比如这里了我选择的是2

emulator
</code></pre><p>如果你是在编译完后立刻运行虚拟机,由于我们之前已经执行过source及lunch命令了,因此现在你只需要执行命令就可以运行虚拟机:</p>
<p>既然谈到了模拟器运行,这里我们顺便介绍模拟器运行所需要四个文件:</p>
<pre><code>Linux Kernel
system.
img
userdate
.img
ramdisk.img
</code></pre><p>如果你在使用lunch命令时选择的是aosp_arm-eng,<br>那么在执行不带参数的emualtor命令时,Linux Kernel默认使用的是/source/prebuilds/qemu-kernel/arm/kernel-qemu目录下的kernel-qemu文件<br>;而android镜像文件则是默认使用source/out/target/product/generic目录下的system.img,userdata.img和ramdisk.img,也就是我们刚刚编译出来的镜像文件.</p>
<p>上面我在使用lunch命令时选择的是aosp_arm64-eng,因此linux默认使用的/source/prebuilds/qemu-kernel/arm64/kernel-qemu下的kernel-qemu,<br>而其他文件则是使用的source/out/target/product/generic64目录下的system.img,userdata.img和ramdisk.img.<br>当然,emulator指令允许你通过参数制定使用不同的文件,具体用法可以通过emulator –help查看</p>
<p>##模块编译<br>除了通过make命令编译可以整个android源码外,<br>Google也为我们提供了相应的命令来支持单独模块的编译.</p>
<p>编译环境初始化(即执行source build/envsetup.sh)之后,我们可以得到一些有用的指令,<br>除了上边用到的lunch,还有以下:</p>
<pre><code>- croot: Changes directory to the top of the tree.

- m: Makes from the top of the tree.

- mm: Builds all of the modules in the current directory.

- mmm: Builds all of the modules in the supplied directories.

- cgrep: Greps on all local C/C++ files.
- jgrep: Greps on all local Java files.

- resgrep: Greps on all local res/*.xml files.

- godir: Go to the directory containing a file.
</code></pre><p>其中mmm指令就是用来编译指定目录.通常来说,每个目录只包含一个模块.比如这里我们要编译Launcher2模块,<br>执行指令:</p>
<p>mmm packages/apps/Launcher2/<br>稍等一会之后,<br>如果提示:</p>
<pre><code>### make completed success fully ###
</code></pre><p>即表示编译完成,<br>此时在out/target/product/gereric/system/app就可以看到编译的Launcher2.apk文件了.</p>
<p>重新打包系统镜像<br>编译好指定模块后,如果我们想要将该模块对应的apk集成到系统镜像中,<br>需要借助make snod指令重新打包系统镜像,这样我们新生成的system.img中就包含了刚才编译的Launcher2模块了.<br>重启模拟器之后生效.</p>
<p>单独安装模块<br>我们在不断的修改某些模块,总不能每次编译完成后都要重新打包system.img<br>,然后重启手机吧?有没有什么简单的方法呢?<br>在编译完后,借助adb install命令直接将生成的apk文件安装到设备上即可,<br>相比使用make snod,会节省很多事件.</p>
<p>##补充</p>
<p>我们简单的来介绍out/target/product/generic/system目录下的常用目录:<br>Android系统自带的apk文件都在out/target/product/generic/system/apk目录下;</p>
<p>一些可执行文件(比如C编译的执行),放在out/target/product/generic/system/bin目录下;</p>
<p>动态链接库放在out/target/product/generic/system/lib目录下;</p>
<p>硬件抽象层文件都放在out/targer/product/generic/system/lib/hw目录下.</p>
<p>##SDK编译</p>
<p>如果你需要自己编译SDK使用,很简单,只需要执行命令<code>make sdk</code>即可.</p>
<p>##编译fastboot adb</p>
<pre><code>make fastboot adb
</code></pre><p>##BUILD<br>指的是特定功能的组合的特定名称,即表示编译出的镜像可以运行在什么环境.<br>其中,aosp(Android Open Source Project)代表Android开源项目;arm表示系统<br>是运行在arm架构的处理器上,arm64则是指64位arm架构;处理器,x86则表示x86架<br>构的处理器;此外,还有一些单词代表了特定的Nexus设备,下面是常用的设备代码和<br>编译目标,更多参考官方文档</p>
<pre><code>|受型号|设备代码|编译目标


|Nexus 6P|angler|aosp_angler-userdebug|

|Nexus 5X|bullhead|aosp_bullhead-userdebug|

|Nexus 6|shamu|aosp_shamu-userdebug|

|Nexus 5|hammerhead|aosp_hammerhead-userdebug|
</code></pre><p>##BUILD TYPE<br>则指的是编译类型,通常有三种:</p>
<pre><code>-user:代表这是编译出的系统镜像是可以用来正式发布到市场的版本,
其权限是被限制的(如,没有root权限,不能dedug等)

-userdebug:在user版本的基础上开放了root权限和debug权限.

-eng:代表engineer,也就是所谓的开发工程师的版本,拥有最大的权限(root等),
此外还附带了许多debug工具
</code></pre><p>##清除编译</p>
<pre><code>make clobber
</code></pre><p>##理解 Android Build 系统<br><a href="http://ohjvpki1b.bkt.clouddn.com/%E7%90%86%E8%A7%A3%20Android%20Build%20%E7%B3%BB%E7%BB%9F.pdf" target="_blank" rel="external">外部文档</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/19/提取刷机包内system-new-dat文件/" rel="next" title="提取刷机包内system.new.dat文件">
                <i class="fa fa-chevron-left"></i> 提取刷机包内system.new.dat文件
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/12/19/使用ndk编译c可执行程序/" rel="prev" title="使用ndk编译c可执行程序">
                使用ndk编译c可执行程序 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">我思，故我在！</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">58</span>
                  <span class="site-state-item-name">Artikel</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">我思，故我在！</span>

  
</div>


  <div class="powered-by">Erstellt mit  <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
